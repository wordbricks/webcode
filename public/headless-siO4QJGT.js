import{s as m}from"./semver-Zyv2pDaP.js";const originalFetch=globalThis.fetch;globalThis.fetch=async(n,e)=>{if(!("string"==typeof n&&new URL(n).host!==globalThis.location.host||n instanceof Request&&new URL(n.url).host!==globalThis.location.host))return originalFetch(n,e);return await originalFetch(`${globalThis.location.origin}/api/v1/cors/proxy/${n.replace("https://","")}`,e)};const v=new TextEncoder,w="_stackblitz_app_id_",E=1;function y(n,e=!1){const t=new AbortController;return{promise:A(n,e,t.signal),unsubscribe:()=>t.abort()}}async function A(n,e,t){const r=await S(n,e),o=`${O(n.slug).substring(0,e?10:30)}-${r}`;return t.aborted?new Promise((()=>{})):await _(o,t)}async function S(n,e){const{slug:t,application:r,...o}=n,i=Object.entries(o);i.sort((([n],[e])=>n===e?0:n<e?-1:1)),typeof location<"u"&&i.unshift(["d",location.origin]),i.unshift(["a",r]),i.unshift(["s",t]),i.unshift(["v",String(E)]);const a=v.encode(JSON.stringify(i)),s=await I(a),c=x(s[0],s[1],s[2],s[3]);return e?c:c.slice(0,4)}function _(n,e){return D(n)??new Promise((t=>{b(`app-id-lock/${n}`,e,(r=>{if(e.aborted)return;const o=r?n:M(n);o!==n&&P(n,o),t(o)}))}))}function b(n,e,t){const r=globalThis.navigator?.locks;null!=r?r.request(n,{ifAvailable:!0},(n=>{const r=null!=n;if(t(r),r||!e.aborted)return new Promise((n=>{e.addEventListener("abort",(()=>n()))}))})).catch((()=>{t(!1)})):t(!1)}async function I(n){try{return await T(n)}catch{}return $(n)}async function T(n){const e=await globalThis.crypto.subtle.digest("SHA-1",n);return new Uint8Array(e)}function $(n){let e=5381;for(const t of n)e=(e<<5)+e+t&4294967295;const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}function x(n,e,t,r){return[n>>3,(7&n)<<2|(192&e)>>6,e>>1&31,e%2<<4|(240&t)>>4,(15&t)<<1|(128&r)>>7,r>>2&31].map((n=>L(n))).join("")}function L(n){return n<26?String.fromCharCode(n+97):String.fromCharCode(n-26+48)}function O(n){return n.replace(/[^a-zA-Z0-9]/g,"")}function P(n,e){try{sessionStorage.setItem(`${w}/${n}`,e)}catch{}}function D(n){try{return sessionStorage.getItem(`${w}/${n}`)}catch{return null}}function M(n){return`${n}-${Math.random().toString(36).slice(2,10)}`}const N=1;function R(n){n.addLazyFileHandler({type:N},(async(e,t,r)=>{if(null==r)return console.error(`Unexpected missing metadata for "${e}" request`),new ArrayBuffer(0);const o=r.lastIndexOf("@");if(-1===o)return console.error(`Malformed metadata for "${e}": "${r}"`),new ArrayBuffer(0);const i=r.slice(0,o),a=e.slice(e.lastIndexOf("node_modules")+13+i.length),s=`${n.runtimeInfo.turboURL}/f`;return(await fetch(`${s}/${r}${a}`)).arrayBuffer()}))}function U(n,e,t){n.addLazyFileHandler({pattern:/usr\/local\/lib\/node_modules\/(?:pnpm|yarn)/},(async r=>{let o=e.baseUrl?e.baseUrl:"",i=!0;if(r.includes("yarn.js"))o+="/yarn_index";else{i=!1,o+=`/${await C(n,t)??n.runtimeInfo.packageManagers.pnpm.at(-1).index}`}"DEV_STANDALONE"!==t.environment&&t.version&&i&&(o+=`.${t.version}`);const a=await(await fetch(o,{credentials:"same-origin",mode:"cors"})).arrayBuffer();await n.loadFiles(new Uint8Array(a))}))}let g=null;async function C(n,e){return null==g&&(g=k(n,e).catch((n=>{console.log(n)}))),g}async function k(n,e){const{project:t,semver:r}=e;if(null==t||null==r)return;const o=await t.home,i=await n.readFile(o.replace(/\/$/,"")+"/package.json",void 0,"utf8"),a=JSON.parse(i),s=a.packageManager?.match(/^pnpm@(.*)$/)?.[1],c=a?.engines?.pnpm,l=s??c;if(null==l)return;const u=[...n.runtimeInfo.packageManagers.pnpm],f=(n,e)=>r.satisfies(n,e)||r.ltr(n,e);for(const{version:n,index:e}of u.reverse())if(f(n,l))return e}const F={NEXT_TELEMETRY_DISABLED:"1",ASTRO_TELEMETRY_DISABLED:"1",__NEXT_DISABLE_MEMORY_WATCHER:"1",NG_CLI_ANALYTICS:"false"},V={...F,EDITOR:"code"},B=async()=>h()??(await new Promise((n=>{window.addEventListener("load",(()=>n()))})),h()),h=()=>JSON.parse(document.querySelector("#webcontainer-context")?.textContent??"null");async function H(){const n=await B();n.warningMessage&&console.warn(n.warningMessage);const e=window.WebContainer,t=window.WebContainerAPIServer,r=new URL(location.href).searchParams.get("version")??void 0,o="/api/tokens/embedder/"+n.embedderId;setInterval((()=>fetch(o)),1e3*n.refreshInterval),new t({defaultEnv:V,endpoint:window.parent,origin:n.embedder,version:r,async factory({webcontainerOptions:t,ready:r}){const o=await y({slug:n.embedderId,application:"headless"},n.shortAppId).promise,i=new e({...n.options,...t,systemBinaries:{git:!1},initOptions:{...n.options.initOptions,appId:o,isolationPolicy:n.options.initOptions.isolationPolicy??void 0},onError(n){}});return U(i,n.options,{version:n.options.initOptions.version,project:{home:r.then((({cwd:n})=>n))},semver:{satisfies:m.satisfies,ltr:m.ltr}}),R(i),{instance:i,appId:o,authenticationRequired:n.authenticationRequired}}}).listen()}const j=window.parent!==window;j&&H();
